---
layout: post
title: "Last touches to the network - a dedicated VM box and working printer"
image: "post-assets/2020-10-17-new-vmbox/banner.jpg"
category: technology
subcategory: electronics
tags:  microserver computer NAS docker network raspberrypi
assets: "post-assets/2020-10-17-new-vmbox"
published: true
---

As mentioned in the previous [network-related post]({% post_url 2020-10-04-new-nas-and-updates %}), I not only fixed the corner up but also bought a Lenovo Thinkcentre M72e Tiny. Its a tiny little device which I plan on using for experimenting with dockers, vm's, proxmox and all that jazz without affecting my NAS nor the Raspberry Pi. In addition I took the time last weekend to finally start using a newer laser printer I had around, and overcame the fact that Synology didnt natively support it.


## Tiny M72e
pros:
 - remarkably small form factor
 - reasonable ram
 - ok processor

cons:
 - no USB 3.0
 - only one sata port

 Add photos

## Proxmox and docker

installed, allocated ip, etc.

dark theme (https://github.com/Weilbyte/PVEDiscordDark)

added nas as storage

installed local and NAS based Xubuntu, not much difference.

installed docker inside a VM/Container

mention thinking about reverting to a simple debian install with virtual box and docker

## printer
Previously I was using a bulky and ancient *HP Laserjet 1022*, which was released [back in 2005](https://www.cnet.com/reviews/hp-laserjet-1022-review/). It was obnoxiously computer grey (which stood out in my all black LACK corner) and pulled nearly 3W whilst idle, all meanwhile I had a perfectly good and slightly more modern *Brother HL-1110* sitting in storage. So I decided to swap them out.

As usual nothing goes to plan in my weekends, and it turns out a benefit of the age of the HP is that it was ~~well~~ supported within DSM. Not really officially since remote printing as a feature has been dropped overall but it worked and I could print from my desktop. Luckily being docker-enabled allowed me now to boot up a dedicated CUPS docker, pass the device and handle it from there. It was broadly following [this guide](http://www.theghostbit.com/2016/10/setting-up-cups-server-with-docker-on.html) however, there were subtle differences...
 - The `--hard-stop cupsd` works but still doesn't kill whatever is handling the printer within Synology, so I have to remove printer manually
 - Using the [newer docker file](https://registry.hub.docker.com/r/olbat/cupsd#!) from the same author, actually works great and already has the drivers
 - I gave the docker a local mount for  the configuration of the CUPS server.

It was working great at first but would consistently fully turn off after a while and then disappear from the USB devices, unable to be woken up again. I embarrasingly took a long time and scoured many old forum posts to find out its not a driver or configuration issue, **this is a goddamn default design feature**. Long story short, I needed to connect it to a windows laptop and use the *Remote Printer Console* from brother to disable the auto shut off. Now for some silly reason it was hidden away from the Windows 10 downloads which meant I didn't see it when downloading drivers (first thing I did). Sigh.

Nevertheless, I'm still ironing out the startup after resets as sometimes I need to change the device address I pass through, but overall it now works great, it has 0.2W idle power draw, prints when needed, and get access to all the usual functions like double sided printing which I couldn't with the Synology print server. Yay!

## Overall concept


## Pi Heatsinks

## Cable management and general reorganisation


## The New DS716+ NAS box



## But wait there's more!


## Conclusion
Don't get me wrong, this setup is still over-complicated and over-kill, and honestly I could trim some fat and merge parts, but it would also be less fun. Overall I'm pretty pleased with how it stands and it's been good practice to play around with all the portions. I'll continue removing random devices I have littered around the house which don't do anything and just focusing on keeping this central core part running just as I like it, possibly changing parts here and there, but will see. For now its not going to be changing any time soon...

## Credit and Further links
